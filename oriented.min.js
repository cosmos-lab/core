"use strict";const Orns=(e,t,n)=>{const r=new OrnCollection(e);if(!r.get())return void(Orn.debug&&console.log(`DYM-ERROR: Container not found for selector "${e}"`,t,e));const i=(n=new OrnTemplate(void 0!==n?n:r.get())).ProcesS();for(;r.get().firstChild;)r.get().removeChild(r.get().firstChild);i.map(e=>{let n=t instanceof Array?t:[t];OrnParser.Output(OrnParser.Process(OrnParser.Clone(e),!1,0,n),r.get(),void 0!==t.svg)});for(var a=r.find("orn-module"),o=0;o<a.length;o++){let e=new OrnCollection(a[o]);var s=new(new Function([],"return "+e.get().identifier)())(e.get(),e.get().shared);e.get().component=s,void 0!==s.Init&&s.Init()}return r},Orn=async(e,t,n)=>{const r=new OrnCollection(e);if(!r.get())return void(Orn.debug&&console.log(`DYM-ERROR: Container not found for selector "${e}"`,t,e));n=new OrnTemplate(void 0!==n?n:r.get());const i=await n.Process();for(;r.get().firstChild;)r.get().removeChild(r.get().firstChild);i.map(e=>{let n=t instanceof Array?t:[t];var i=OrnParser.Process(OrnParser.Clone(e),!1,0,n);OrnParser.Output(i,r.get(),void 0!==t.svg)});for(var a=r.find("orn-component"),o=0;o<a.length;o++){let e=new OrnCollection(a[o]);if(void 0===e._Loaded){e.attr("src")&&(await Orn.Include(e.attr("src")),e.attr("src",!1,!0));var s=new(new Function([],"return "+e.get().identifier)())(e.get(),e.get().shared);e.get().component=s,void 0!==s.Init&&await s.Init(),e._Loaded=!0}}for(a=r.find("orn-module"),o=0;o<a.length;o++){let e=new OrnCollection(a[o]);void 0===e.get().component&&(s=new(new Function([],"return "+e.get().identifier)())(e.get(),e.get().shared),e.get().component=s,void 0!==s.Init&&await s.Init())}for(a=r.find("orn-template"),o=0;o<a.length;o++){let e=a[o],n=e.getAttribute("src");if(n){if(!e._Loaded){var l=e.shared;await Orn(e,[t,l],n),e._Loaded=!0}}else Orn.debug&&console.log("DYM-ERROR: Template src not found:",e)}return r};Orn.Include=async e=>{if(Orn.Include.queue||(Orn.Include.queue={}),"string"==typeof e){var t=e;if(t.match(/\.css/)){if(!document.querySelector('link[href="'+t+'"]')){const e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=t,new OrnCollection("head").append(e)}}else{var n=document.querySelector('script[src="'+t+'"]');n?await new Promise((e,r)=>{Orn.Sleep((function(){return void 0===Orn.Include.queue[t]?(e(),!0):"ERROR"==Orn.Include.queue[t]&&(r(),n.parentNode.removeChild(n),!0)}))}):await new Promise((e,n)=>{Orn.Include.queue[t]=!0;const r=document.createElement("script");r.onload=function(){delete Orn.Include.queue[t],e()},r.onerror=function(){Orn.Include.queue[t]="ERROR",n()},r.async=!0,document.body.appendChild(r),r.src=t})}}else for(var r=0;r<e.length;r++)await Orn.Include(e[r])},Orn.Sleep=e=>{e()||setTimeout((function(){Orn.Sleep(e)}))};class OrnTemplate{constructor(e){this.template=e}async Process(){return this.IsElement()?this.Parse(this.template).children:this.IsURL()?await this.LoadHTML():this.VDOM(this.template)}async LoadHTML(){const e=this.template;if(void 0===OrnTemplate.cache[e]){OrnTemplate.cache[e]=!0;var t=await fetch(e,{cache:"force-cache"});if(!t.ok)throw Error(e+" not found or internet connection error.");t=await t.text(),OrnTemplate.cache[e]=this.VDOM(t)}return!0===OrnTemplate.cache[e]&&await new Promise((t,n)=>{Orn.Sleep((function(){return!0!==OrnTemplate.cache[e]&&(t(),!0)}))}),OrnTemplate.cache[e]}ProcesS(){return this.IsElement()?this.Parse(this.template).children:this.VDOM(this.template)}IsURL(){return!this.template.match(/(\<.*\>)|\n/gi)}IsElement(){return"string"!=typeof this.template}VDOM(e){let t=document.createElement("div");return t.innerHTML=e,this.Parse(t).children}Parse(e,t){var n={tag:e.nodeName.toLowerCase(),attributes:[]};if("#comment"!=n.tag){if("option"==n.tag&&(n.html=e.text),"#text"==n.tag)return n.text=e.textContent,n;if("style"==n.tag)return document.body.append(e),n;for(var r=0;r<e.attributes.length;r++){var i=e.attributes[r];if(n.attributes.push({name:i.name,value:i.value}),"orn-module"==i.name&&!t){var a=i.value;if(OrnTemplate.cache[a])return OrnTemplate.cache[a];OrnTemplate.cache[a]=this.Parse(e,!0)}}if("orn-module"==n.tag&&!t){let t=e.getAttribute("identifier");return OrnTemplate.cache[t]||(OrnTemplate.cache[t]=this.Parse(e,!0)),OrnTemplate.cache[t]}n.children=[];for(var o=0;o<e.childNodes.length;o++){var s=e.childNodes[o],l=this.Parse(s);n.children.push(l)}return n}}}class OrnCollection extends Array{constructor(e,t){super(),!t||t instanceof Array||(t=[t]),t=t||[document];for(let r=0;r<t.length;r++){var n=[];if(e instanceof Array)n=e;else if("object"==typeof e)n=[e];else if(e){e=e.split(",");for(let i=0;i<e.length;i++)n=n.concat(Array.from(t[r].querySelectorAll(e[i])))}for(let e=0;e<n.length;e++)this.push(n[e])}}get(e){return!!this.length&&this[e||0]}parent(){return new OrnCollection(!!this.length&&this[0].parentNode)}first(){return new OrnCollection(this[0])}last(){return new OrnCollection(this[this.length-1])}next(){return new OrnCollection(this[0].nextSibling)}prev(){return new OrnCollection(this[0].previousSibling)}siblings(e){e=e||"*";var t=this,n=new OrnCollection(Array.from(this.length&&this.get().parentNode?this.get().parentNode.children:[]));return n.filter((function(n){return n!=t.get()&&n.matches(e)}))}empty(){return this.forEach(e=>{for(;e.firstChild;)e.removeChild(e.firstChild)}),this}remove(){this.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)})}css(e,t){if(void 0===t)return this.length&&this.get().classList.contains(e);const n=e.split(" ");return!1===t?(this.forEach(e=>{n.forEach(t=>{e.classList.remove(t)})}),this):(this.forEach(e=>{n.forEach(t=>{e.classList.add(t)})}),this)}style(e,t){return void 0===t?this.get().style.getPropertyValue(e):(this.forEach(n=>{!1===t&&n.style.removeProperty(e),n.style.setProperty(e,t)}),this)}toggle(e,t){return void 0!==t?this.forEach(n=>{n.innerHTML=n.innerHTML==t?e:t}):this.forEach(t=>{t.classList.toggle(e)}),this}hide(){return this.forEach(e=>{e.style.display="none"}),this}show(){return this.forEach(e=>{e.style.removeProperty("display")}),this}append(e,t){return this.forEach(n=>{if("string"==typeof e){var r=document.createElement("div");r.innerHTML=e.trim(),e=r.firstElementChild}void 0!==t&&n.firstChild?n.insertBefore(e,n.firstElementChild):n.append(e)}),this}html(e){return void 0===e?this.length?this.get().innerHTML:"":(this.forEach(t=>{t.innerHTML=e}),this)}find(e){return new OrnCollection(e,this)}attr(e,t,n){return t||n?(this.forEach(r=>{n?r.removeAttribute(e,t):r.setAttribute(e,t)}),this):this.get().getAttribute(e)}each(e){return this.forEach(t=>{e.call(t,t)}),this}event(e,t){return t?(this.forEach(n=>{n.addEventListener(e,e=>{t.call(n,e)})}),this):(this.forEach(t=>{var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0),t.dispatchEvent(n)}),this)}delegate(e,t,n,r){this.each(i=>{i.addEventListener(t,t=>{for(var r=new OrnCollection(e),i=!1,a=t.target;a;)r.each(e=>{a==e&&(i=a,t.stopPropagation())}),a=a.parentNode;i&&n.call(i,t)},void 0!==r)})}offset(e){var t=this.get();return{width:t.offsetWidth,height:t.offsetHeight,left:t.offsetLeft,top:t.offsetTop}}children(e){var t=[];return this.each(e=>{t=t.concat(Array.from(e.children))}),new OrnCollection(t)}ancestor(e,t){let n=new OrnCollection(e).get();t||(t=this.get());var r=t.parentNode;return!(!r||r==document.body)&&(n==r?r:this.ancestor(e,r))}}class OrnParser{constructor(e,t,n,r,i){this.scope=i,this.node=e,this.parent=t,this.index=n,this.attribute=r}static Clone(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var n=0,r=e.length;n<r;n++)t[n]=OrnParser.Clone(e[n]);return t}if(e instanceof Object){for(var i in t={},e)e.hasOwnProperty(i)&&(t[i]=OrnParser.Clone(e[i]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}static Process(e,t,n,r){if(void 0===n&&(n=0),!e||!e.tag)return void(Orn.debug&&console.log("DYM-ERROR: Invalid HTML tag",arguments));const i=e.tag;if("#comment"===i)return e;if("#text"===i){var a=e.text.match(/\{\{(.*?)\}\}/gi);if(null!==a){c=new OrnParser(e,t,n,!1,r);for(var o=0;o<a.length;o++){let t=c.Parse(a[o].replace(/\{\{|\}\}/gi,""));e.text=e.text.replace(a[o],t)}}return e}var s=!1;const l=e.attributes.find(e=>"orn-repeat"==e.name);if(!l){for(let i=0;i<e.attributes.length;i++){let a=e.attributes[i];if(/^orn-/.test(a.name)&&!s){a.index=i;var c=new OrnParser(e,t,n,a,r);switch(!0){case"orn-module"===a.name:break;case/^orn-on/.test(a.name):c.OnEvent();break;case"orn-show"===a.name:c.Show();break;case"orn-model"===a.name:c.InputModel();break;case"orn-class"===a.name:c.CSSClass();break;case"orn-style"===a.name:c.CSSStyle();break;case"orn-if"===a.name:c.Condition()||(s=!0);break;case"orn-checked"===a.name||"orn-selected"===a.name||"orn-disabled"===a.name:c.InputState();break;default:c.Attribute()}}}if(e.children&&e.children.length)for(let t in e.children){var h=e.children[t];OrnParser.Process(h,e,t,r)}return e}l.index=e.attributes.indexOf(l),new OrnParser(e,t,n,l,r).Repeat()}static Output(e,t,n){if(e&&e.tag){if(e.text){var r=e.text;return"function"==typeof e.text&&(r=e.text(i)),void(t.isOption?t.text=r:t.appendChild(document.createTextNode(r)))}if(n)i=document.createElementNS("http://www.w3.org/2000/svg",e.tag);else var i=document.createElement(e.tag);if(e.html){var a=e.html;"function"==typeof e.html&&(a=e.html(i)),i.innerHTML=a}for(var o=0;o<e.attributes.length;o++){var s=e.attributes[o];void 0!==s.value&&(s.name[0]+s.name[1]==="on"?i.addEventListener(s.name.replace("on",""),function(e){return function(t){this.model&&this.model(t),"string"!=typeof e?e(t,i):new Function("a",e).call(this,t,i)}}(s.value)):"value"===s.name?i.value=s.value:"model"===s.name?(i.model=function(e){return function(t){this.event=t,"string"!=typeof e?e(this):new Function("a",e).call(this)}}(s.value),function(e,t){t.addEventListener("change",(function(e){this.model(e)})),t.addEventListener("keyup",(function(e){this.model(e)}))}(s.value,i)):"show"===s.name?(i.show=function(e){return function(){"string"!=typeof e?e(this):new Function("a",e).call(this)}}(s.value),i.setAttribute("orn-show","")):null!==s.value&&("function"==typeof s.value&&(s.value=s.value(i)),"object"!=typeof s.value&&"identifier"!=s.name||new Function(["value"],`this.${s.name} = value`).call(i,s.value),i.setAttribute(s.name,s.value)))}if(e.children)for(var l=0;l<e.children.length;l++)i.isOption="option"==e.tag,OrnParser.Output(e.children[l],i,n);return null!==e.position&&void 0!==e.position?t.insertBefore(i,t.childNodes[e.position]):t.appendChild(i),i}}Parse(e){var t=e;const n=this.Args();try{t=new Function(n.arg,"return "+e).apply(this.scope[0],n.val)}catch(n){t=null,Orn.debug&&console.log(`DYM-ERROR: Expression "${e}" not found in scope`,this.scope)}return t}Args(){const e={arg:[],val:[]};for(let t in this.scope)for(let n in this.scope[t])e.arg.push(n),e.val.push(this.scope[t][n]);return e.arg.push("event"),e.arg.push("element"),e.val.push(!1),e.val.push(!1),e}Repeat(){let e=this.attribute.value.split(" as "),t=this.Parse(e[0].replace(/ \n\t\r/gi,""));if(!t)return;e=e[1].replace(/ \n\t\r/gi,"").split(":");const n=e[0],r=e[1];var i=0;this.parent||console.log("orn-repeat must be in a container",this.attribute.value),this.parent.children[this.index]=!1;for(let e in t){if(!t.hasOwnProperty(e))return;var a=OrnParser.Clone(this.node);a.attributes.splice(this.attribute.index,1);let o={};o[n]=isNaN(e)?e:1*e,o[r]=t[e];let s=[...this.scope,o],l=OrnParser.Process(a,this.parent,0,s);l.position=1*this.index+i++,this.parent.children.push(l)}}Data(){let e=this.Parse(this.attribute.value);"object"==typeof e&&(e=JSON.stringify(e)),this.node.attributes[this.attribute.index]={name:this.attribute.name.replace("orn-",""),value:e}}OnEvent(){const e=this.Args();var t,n,r,i,a=this.attribute.value;if(a.match(/([a-xA-z]+[a-zA-z0-9_]*)\((.*?)\)/gi))try{let n=a.replace(/\((.*?)\)/gi,"");t=new Function(e.arg,`\n                            try{ \n                                return typeof this.${n}!='undefined' ? this.${a} : ${a}\n                            }catch(e){\n                                try{\n                                    return ${a};\n                                }catch(e){\n                                    \n                                }\n                            }\n                    `)}catch(e){return void(Orn.debug&&console.log(`DYM-ERROR: orn-on expression "${a}" not found in provided scope:`,this.scope))}else t=new Function(e.arg,"return "+a.replace(/\n/g,""));this.node.attributes[this.attribute.index]={name:this.attribute.name.replace("orn-",""),value:(n=t,r=e.val,i=this,function(e,t){r[r.length-2]=e,r[r.length-1]=t,n.apply(i.scope[0],r)})}}Show(){var e,t;this.node.attributes[this.attribute.index]={name:"show",value:(e=this,t=this.attribute.value,function(n){var r=!1;try{r=new Function(["o"],"return o."+t)(e.scope[0])}catch(n){r=e.Parse(t)}r?n.style.removeProperty("display"):n.style.display="none"})}}InputModel(){var e,t,n,r=this.node.attributes.find(e=>"type"===e.name);this.node.attributes[this.attribute.index]={name:"model",value:(e=this,t=this.attribute.value,n=e.Parse(t),function(i){switch(!0){case r&&("checkbox"==r.value||"radio"==r.value):if(n instanceof Array){var a=-1===n.indexOf(i.value);i.checked?a&&n.push(i.value):!a&&n.splice(n.indexOf(i.value),1)}else i.checked?n=i.value:"radio"!==i.type&&(n="");break;case"SELECT"===e.node.tag:if(i.multiple){n=[];for(var o=0;o<i.options.length;o++){var s=i.options[o];s.selected&&n.push(s.value||s.text)}}else n=i.value;break;default:n instanceof Array?-1===n.indexOf(i.value)&&n.push(i.value):n=i.value}new OrnParser(!1,!1,!1,!1,[...e.scope,{_inputvalue:n}]).Parse(t+"=_inputvalue")})}}InputState(){this.Parse(this.attribute.value)&&(this.node.attributes[this.attribute.index]={name:this.attribute.name.replace("orn-",""),value:!0})}CSSClass(){var e=this.node.attributes.find(e=>"class"===e.name);e||(e={name:"class",value:""},this.node.attributes.push(e));var t=this.Parse(this.attribute.value);if(delete this.attribute.value,"string"==typeof t)e.value+=" "+t;else if("object"==typeof t)for(let n in t)t[n]&&(e.value+=" "+n);else"function"==typeof t&&(e.value+=" "+t(this.scope))}CSSStyle(){var e=this.node.attributes.find(e=>"style"===e.name);e||(e={name:"style",value:""},this.node.attributes.push(e));var t=this.Parse(this.attribute.value);if(delete this.attribute.value,"string"==typeof t)e.value+=";"+t;else if("object"==typeof t)for(let n in t)t[n]&&(e.value+=";"+n)}Condition(){var e=this.Parse(this.attribute.value);return delete this.attribute.value,!!e||(this.node.tag=!1,this.node.children=[],this.parent&&(this.parent.children[this.index]=!1),!1)}Attribute(){if("TEXTAREA"===this.node.tag&&"orn-value"===this.attribute.name)this.node.html=this.Parse(this.attribute.value);else{let e=this.Parse(this.attribute.value);this.node.attributes[this.attribute.index]={name:this.attribute.name.replace("orn-",""),value:e||""}}}}class FetchWrapper{constructor(e,t,n){void 0===t&&(t={}),void 0===n&&(n={}),n.noerror&&(this.noerror=!0),this.url=e,this.config={headers:{},credentials:"same-origin"},"undefined"!=typeof AbortController&&(this.controller=new AbortController,this.config.signal=this.controller.signal),n.post?(this.config.method="POST",this.config.body=Fetch.FD(t)):this.url=`${this.url}${-1==this.url.indexOf("?")?"?":"&"}${Fetch.QS(t)}`,n.offline&&(this.config.headers.offline=!0),n.persist&&(this.config.headers.persist=!0)}Abort(){this.controller&&this.controller.abort()}async Load(){var e=!1;try{if(!(e=await fetch(this.url,this.config)).ok)throw Error();e="application/json"==e.headers.get("content-type")?await e.json():await e.text()}catch(e){}return e}}var HashPath=()=>location.hash.substring(1,location.hash.length).split("/"),Selector=e=>new OrnCollection(e),Fetch=(e,t,n)=>new FetchWrapper(e,t,n);Fetch.QS=(e,t,n)=>{if(void 0===n&&(n=[]),!e||"object"!=typeof e||e instanceof Date||e instanceof File){const r=null==e?"":e;n.push(`${t}=${r}`)}else Object.keys(e).forEach(r=>{Fetch.QS(e[r],t?`${t}[${r}]`:r,n)});return t||(n=n.join("&")),n},Fetch.FD=(e,t,n)=>{if(void 0===n&&(n=new FormData),!e||"object"!=typeof e||e instanceof Date||e instanceof File){const r=null==e?"":e;n.append(t,r)}else Object.keys(e).forEach(r=>{Fetch.FD(e[r],t?`${t}[${r}]`:r,n)});return n},(()=>{OrnTemplate.cache={},Orn.debug=!1,OrnTemplate.cache={},setInterval((function(){let e=document.querySelectorAll('*[orn-show=""]');if(e)for(let t=0;t<e.length;t++)e[t].show&&e[t].show()}),50);try{document.createEvent("TouchEvent"),Orn.touch={}}catch(e){Orn.touch=!1}Selector("body").delegate(".orn-touch-listener","touchstart",(function(e){Orn.touch.moved=0,Orn.touch.starter=[],Orn.touch.started=[];for(var t=0;t<e.touches.length;t++){var n=e.touches[t];Orn.touch.starter.push({el:document.elementFromPoint(n.clientX,n.clientY)}),Orn.touch.started.push({x:n.clientX,y:n.clientY})}})),Selector("body").delegate(".orn-touch-listener","touchmove",(function(e){var t=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY);t.dispatchEvent(new CustomEvent("touchover",{detail:{target:t}}))})),Selector("body").delegate(".orn-touch-listener","touchend",(function(e){var t=e.changedTouches[0].clientX-Orn.touch.started[0].x;e.changedTouches[0].clientY,Orn.touch.started[0].y,t>0&&this.dispatchEvent(new CustomEvent("touchmoveright",{detail:{target:this}})),t<0&&this.dispatchEvent(new CustomEvent("touchmoveleft",{detail:{target:this}}))}))})();