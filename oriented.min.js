"use strict";const Orns=(e,t,r)=>{const n=new OrnCollection(e);if(!n.get())return void(Orn.debug&&console.log(`DYM-ERROR: Container not found for selector "${e}"`,t,e));const i=(r=new OrnTemplate(void 0!==r?r:n.get())).ProcesS();for(;n.get().firstChild;)n.get().removeChild(n.get().firstChild);return i.map(e=>{let r=t instanceof Array?t:[t];OrnParser.Output(OrnParser.Process(OrnParser.Clone(e),!1,0,r),n.get())}),n},Orn=async(e,t,r)=>{const n=new OrnCollection(e);if(!n.get())return void(Orn.debug&&console.log(`DYM-ERROR: Container not found for selector "${e}"`,t,e));r=new OrnTemplate(void 0!==r?r:n.get());const i=await r.Process();for(;n.get().firstChild;)n.get().removeChild(n.get().firstChild);i.map(e=>{let r=t instanceof Array?t:[t];OrnParser.Output(OrnParser.Process(OrnParser.Clone(e),!1,0,r),n.get())});for(var a=n.find("orn-component"),s=0;s<a.length;s++){let e=new OrnCollection(a[s]);if(void 0===e._Loaded){e.attr("src")&&(await LazyLoad(e.attr("src")),e.attr("src",!1,!0));var o=new(new Function([],"return "+e.get().identifier)())(e.get(),e.get().shared);e.get().component=o,void 0!==o.Init&&await o.Init(),e._Loaded=!0}}for(a=n.find("orn-template"),s=0;s<a.length;s++){let e=a[s],r=e.getAttribute("src");if(r){if(!e._Loaded){var l=e.shared;await Orn(e,[t,l],r),e._Loaded=!0}}else Orn.debug&&console.log("DYM-ERROR: Template src not found:",e)}return n};class OrnTemplate{constructor(e){this.template=e}async Process(){return this.IsElement()?this.Parse(this.template).children:this.IsURL()?await this.LoadHTML():this.VDOM(this.template)}async LoadHTML(){const e=this.template;if(void 0===OrnTemplate.cache[e]){OrnTemplate.cache[e]=!0;var t=await fetch(e,{cache:"force-cache"});if(!t.ok)throw Error(e+" not found or internet connection error.");t=await t.text(),OrnTemplate.cache[e]=this.VDOM(t)}return!0===OrnTemplate.cache[e]&&await new Promise((t,r)=>{SleepUntil((function(){return!0!==OrnTemplate.cache[e]&&(t(),!0)}))}),OrnTemplate.cache[e]}ProcesS(){return this.IsElement()?this.Parse(this.template).children:this.VDOM(this.template)}IsURL(){return!this.template.match(/(\<.*\>)|\n/gi)}IsElement(){return"string"!=typeof this.template}VDOM(e){let t=document.createElement("div");return t.innerHTML=e,this.Parse(t).children}Parse(e,t){var r={tag:e.nodeName.toLowerCase(),attributes:[]};if("#comment"!==r.tag){if("option"==r.tag&&(r.html=e.text),"#text"==r.tag)return r.text=e.textContent,r;if("style"==r.tag)return document.body.append(e),r;for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n];if(r.attributes.push({name:i.name,value:i.value}),"orn-module"===i.name&&!t){var a=i.value;if(OrnTemplate.cache[a])return OrnTemplate.cache[a];OrnTemplate.cache[a]=this.Parse(e,!0)}}r.children=[];for(var s=0;s<e.childNodes.length;s++){var o=e.childNodes[s],l=this.Parse(o);r.children.push(l)}return r}}}OrnTemplate.cache={};class OrnCollection extends Array{constructor(e,t){super(),!t||t instanceof Array||(t=[t]),t=t||[document];for(let n=0;n<t.length;n++){var r=[];if(e instanceof Array)r=e;else if("object"==typeof e)r=[e];else if(e){e=e.split(",");for(let i=0;i<e.length;i++)r=r.concat(Array.from(t[n].querySelectorAll(e[i])))}for(let e=0;e<r.length;e++)this.push(r[e])}}get(e){return!!this.length&&this[e||0]}parent(){return new OrnCollection(!!this.length&&this[0].parentNode)}first(){return new OrnCollection(this[0])}last(){return new OrnCollection(this[this.length-1])}next(){return new OrnCollection(this[0].nextSibling)}prev(){return new OrnCollection(this[0].previousSibling)}siblings(e){e=e||"*";var t=this,r=new OrnCollection(Array.from(this.length&&this.get().parentNode?this.get().parentNode.children:[]));return r.filter((function(r){return r!=t.get()&&r.matches(e)}))}empty(){return this.forEach(e=>{for(;e.firstChild;)e.removeChild(e.firstChild)}),this}remove(){this.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)})}css(e,t){if(void 0===t)return this.length&&this.get().classList.contains(e);const r=e.split(" ");return!1===t?(this.forEach(e=>{r.forEach(t=>{e.classList.remove(t)})}),this):(this.forEach(e=>{r.forEach(t=>{e.classList.add(t)})}),this)}style(e,t){return void 0===t?this.get().style.getPropertyValue(e):(this.forEach(r=>{!1===t&&r.style.removeProperty(e),r.style.setProperty(e,t)}),this)}toggle(e,t){return void 0!==t?this.forEach(r=>{r.innerHTML=r.innerHTML==t?e:t}):this.forEach(t=>{t.classList.toggle(e)}),this}hide(){return this.forEach(e=>{e.style.display="none"}),this}show(){return this.forEach(e=>{e.style.removeProperty("display")}),this}append(e,t){return this.forEach(r=>{if("string"==typeof e){var n=document.createElement("div");n.innerHTML=e.trim(),e=n.firstElementChild}void 0!==t&&r.firstChild?r.insertBefore(e,r.firstElementChild):r.append(e)}),this}html(e){return void 0===e?this.length?this.get().innerHTML:"":(this.forEach(t=>{t.innerHTML=e}),this)}find(e){return new OrnCollection(e,this)}attr(e,t,r){return t||r?(this.forEach(n=>{r?n.removeAttribute(e,t):n.setAttribute(e,t)}),this):this.get().getAttribute(e)}each(e){return this.forEach(t=>{e.call(t,t)}),this}event(e,t){return t?(this.forEach(r=>{r.addEventListener(e,e=>{t.call(r,e)})}),this):(this.forEach(t=>{var r=document.createEvent("HTMLEvents");r.initEvent(e,!0,!0),t.dispatchEvent(r)}),this)}delegate(e,t,r,n){this.each(i=>{i.addEventListener(t,t=>{for(var n=new OrnCollection(e),i=!1,a=t.target;a;)n.each(e=>{a==e&&(i=a,t.stopPropagation())}),a=a.parentNode;i&&r.call(i,t)},void 0!==n)})}offset(e){var t=this.get();return{width:t.offsetWidth,height:t.offsetHeight,left:t.offsetLeft,top:t.offsetTop}}children(e){var t=[];return this.each(e=>{t=t.concat(Array.from(e.children))}),new OrnCollection(t)}ancestor(e,t){let r=new OrnCollection(e).get();t||(t=this.get());var n=t.parentNode;return!(!n||n==document.body)&&(r==n?n:this.ancestor(e,n))}}class OrnParser{constructor(e,t,r,n,i){this.scope=i,this.node=e,this.parent=t,this.index=r,this.attribute=n}static Clone(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var r=0,n=e.length;r<n;r++)t[r]=OrnParser.Clone(e[r]);return t}if(e instanceof Object){for(var i in t={},e)e.hasOwnProperty(i)&&(t[i]=OrnParser.Clone(e[i]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}static Process(e,t,r,n){if(void 0===r&&(r=0),!e||!e.tag)return void(Orn.debug&&console.log("DYM-ERROR: Invalid HTML tag",arguments));const i=e.tag;if("#comment"===i)return e;if("#text"===i){var a=e.text.match(/\{\{(.*?)\}\}/gi);if(null!==a){h=new OrnParser(e,t,r,!1,n);for(var s=0;s<a.length;s++){let t=h.Parse(a[s].replace(/\{\{|\}\}/gi,""));e.text=e.text.replace(a[s],t)}}return e}var o=!1;const l=e.attributes.find(e=>"orn-repeat"==e.name);if(!l){for(let i=0;i<e.attributes.length;i++){let a=e.attributes[i];if(/^orn-/.test(a.name)&&!o){a.index=i;var h=new OrnParser(e,t,r,a,n);switch(!0){case"orn-module"===a.name:break;case/^orn-on/.test(a.name):h.OnEvent();break;case"orn-show"===a.name:h.Show();break;case"orn-model"===a.name:h.InputModel();break;case"orn-class"===a.name:h.CSSClass();break;case"orn-style"===a.name:h.CSSStyle();break;case"orn-if"===a.name:h.Condition()||(o=!0);break;case"orn-checked"===a.name||"orn-selected"===a.name||"orn-disabled"===a.name:h.InputState();break;default:h.Attribute()}}}if(e.children&&e.children.length)for(let t in e.children){var c=e.children[t];OrnParser.Process(c,e,t,n)}return e}l.index=e.attributes.indexOf(l),new OrnParser(e,t,r,l,n).Repeat()}static Output(e,t){if(e&&e.tag){if(e.text){var r=e.text;return"function"==typeof e.text&&(r=e.text(n)),void(t.isOption?t.text=r:t.appendChild(document.createTextNode(r)))}for(var n=document.createElement(e.tag),i=0;i<e.attributes.length;i++){var a=e.attributes[i];void 0!==a.value&&(a.name[0]+a.name[1]==="on"?n.addEventListener(a.name.replace("on",""),function(e){return function(t){this.model&&this.model(t),"string"!=typeof e?e(t,n):new Function("a",e).call(this,t,n)}}(a.value)):"value"===a.name?n.value=a.value:"model"===a.name?(n.model=function(e){return function(t){this.event=t,"string"!=typeof e?e(this):new Function("a",e).call(this)}}(a.value),function(e,t){t.addEventListener("change",(function(e){this.model(e)})),t.addEventListener("keyup",(function(e){this.model(e)}))}(a.value,n)):"show"===a.name?(n.show=function(e){return function(){"string"!=typeof e?e(this):new Function("a",e).call(this)}}(a.value),n.setAttribute("orn-show","")):null!==a.value&&("function"==typeof a.value&&(a.value=a.value(n)),"object"==typeof a.value||"identifier"==a.name?new Function(["value"],`this.${a.name} = value`).call(n,a.value):n.setAttribute(a.name,a.value)))}if(e.children)for(var s=0;s<e.children.length;s++)n.isOption="option"==e.tag,OrnParser.Output(e.children[s],n);return null!==e.position&&void 0!==e.position?t.insertBefore(n,t.childNodes[e.position]):t.appendChild(n),n}}Parse(e){var t=e;const r=this.Args();try{t=new Function(r.arg,"return "+e).apply(this.scope[0],r.val)}catch(r){t=null,Orn.debug&&console.log(`DYM-ERROR: Expression "${e}" not found in scope`,this.scope)}return t}Args(){const e={arg:[],val:[]};for(let t in this.scope)for(let r in this.scope[t])e.arg.push(r),e.val.push(this.scope[t][r]);return e.arg.push("event"),e.arg.push("element"),e.val.push(!1),e.val.push(!1),e}Repeat(){let e=this.attribute.value.split(" as "),t=this.Parse(e[0].replace(/ \n\t\r/gi,""));if(!t)return;e=e[1].replace(/ \n\t\r/gi,"").split(":");const r=e[0],n=e[1];var i=0;this.parent||console.log("orn-repeat must be in a container",this.attribute.value),this.parent.children[this.index]=!1;for(let e in t){if(!t.hasOwnProperty(e))return;var a=OrnParser.Clone(this.node);a.attributes.splice(this.attribute.index,1);let s={};s[r]=isNaN(e)?e:1*e,s[n]=t[e];let o=[...this.scope,s],l=OrnParser.Process(a,this.parent,0,o);l.position=1*this.index+i++,this.parent.children.push(l)}}Data(){let e=this.Parse(this.attribute.value);"object"==typeof e&&(e=JSON.stringify(e)),this.node.attributes[this.attribute.index]={name:this.attribute.name.replace("orn-",""),value:e}}OnEvent(){const e=this.Args();var t,r,n,i,a=this.attribute.value;if(a.match(/([a-xA-z]+[a-zA-z0-9_]*)\((.*?)\)/gi))try{let r=a.replace(/\((.*?)\)/gi,"");t=new Function(e.arg,`\n                            try{ \n                                return typeof this.${r}!='undefined' ? this.${a} : ${a}\n                            }catch(e){\n                                try{\n                                    return ${a};\n                                }catch(e){\n                                    \n                                }\n                            }\n                    `)}catch(e){return void(Orn.debug&&console.log(`DYM-ERROR: orn-on expression "${a}" not found in provided scope:`,this.scope))}else t=new Function(e.arg,"return "+a.replace(/\n/g,""));this.node.attributes[this.attribute.index]={name:this.attribute.name.replace("orn-",""),value:(r=t,n=e.val,i=this,function(e,t){n[n.length-2]=e,n[n.length-1]=t,r.apply(i.scope[0],n)})}}Show(){var e,t;this.node.attributes[this.attribute.index]={name:"show",value:(e=this,t=this.attribute.value,function(r){var n=!1;try{n=new Function(["o"],"return o."+t)(e.scope[0])}catch(r){n=e.Parse(t)}n?r.style.removeProperty("display"):r.style.display="none"})}}InputModel(){var e,t,r,n=this.node.attributes.find(e=>"type"===e.name);this.node.attributes[this.attribute.index]={name:"model",value:(e=this,t=this.attribute.value,r=e.Parse(t),function(i){switch(!0){case n&&("checkbox"==n.value||"radio"==n.value):if(r instanceof Array){var a=-1===r.indexOf(i.value);i.checked?a&&r.push(i.value):!a&&r.splice(r.indexOf(i.value),1)}else i.checked?r=i.value:"radio"!==i.type&&(r="");break;case"SELECT"===e.node.tag:if(i.multiple){r=[];for(var s=0;s<i.options.length;s++){var o=i.options[s];o.selected&&r.push(o.value||o.text)}}else r=i.value;break;default:r instanceof Array?-1===r.indexOf(i.value)&&r.push(i.value):r=i.value}new OrnParser(!1,!1,!1,!1,[...e.scope,{_inputvalue:r}]).Parse(t+"=_inputvalue")})}}InputState(){this.Parse(this.attribute.value)&&(this.node.attributes[this.attribute.index]={name:this.attribute.name.replace("orn-",""),value:!0})}CSSClass(){var e=this.node.attributes.find(e=>"class"===e.name);e||(e={name:"class",value:""},this.node.attributes.push(e));var t=this.Parse(this.attribute.value);if(delete this.attribute.value,"string"==typeof t)e.value+=" "+t;else if("object"==typeof t)for(let r in t)t[r]&&(e.value+=" "+r);else"function"==typeof t&&(e.value+=" "+t(this.scope))}CSSStyle(){var e=this.node.attributes.find(e=>"style"===e.name);e||(e={name:"style",value:""},this.node.attributes.push(e));var t=this.Parse(this.attribute.value);if(delete this.attribute.value,"string"==typeof t)e.value+=";"+t;else if("object"==typeof t)for(let r in t)t[r]&&(e.value+=";"+r)}Condition(){var e=this.Parse(this.attribute.value);return delete this.attribute.value,!!e||(this.node.tag=!1,this.node.children=[],this.parent&&(this.parent.children[this.index]=!1),!1)}Attribute(){if("TEXTAREA"===this.node.tag&&"orn-value"===this.attribute.name)this.node.html=this.Parse(this.attribute.value);else{let e=this.Parse(this.attribute.value);this.node.attributes[this.attribute.index]={name:this.attribute.name.replace("orn-",""),value:e||""}}}}const LazyLoad=async function(e){if(LazyLoad.queue||(LazyLoad.queue={}),"string"==typeof e){var t=e;if(t.match(/\.css/)){if(!document.querySelector('link[href="'+t+'"]')){const e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=t,new OrnCollection("head").append(e)}}else{var r=document.querySelector('script[src="'+t+'"]');r?await new Promise((e,n)=>{SleepUntil((function(){return void 0===LazyLoad.queue[t]?(e(),!0):"ERROR"==LazyLoad.queue[t]&&(n(),r.parentNode.removeChild(r),!0)}))}):await new Promise((e,r)=>{LazyLoad.queue[t]=!0;const n=document.createElement("script");n.onload=function(){delete LazyLoad.queue[t],e()},n.onerror=function(){LazyLoad.queue[t]="ERROR",r()},n.async=!0,document.body.appendChild(n),n.src=t})}}else for(var n=0;n<e.length;n++)await LazyLoad(e[n])},SleepUntil=function(e){e()||setTimeout((function(){SleepUntil(e)}))};Orn.debug=!1,OrnTemplate.cache={},setInterval((function(){let e=document.querySelectorAll('*[orn-show=""]');if(e)for(let t=0;t<e.length;t++)e[t].show&&e[t].show()}),50),"undefined"==typeof Selector&&(window.Selector=e=>new OrnCollection(e));